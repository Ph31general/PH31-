<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PH31 Portal</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
    };
    firebase.initializeApp(firebaseConfig);
    var db = firebase.firestore();
    var auth = firebase.auth();

    // Subjects
    const subjects = [
      "Basic Pharmaceutical Organic Chemistry",
      "Pharmaceutical Analytical Chemistry I",
      "Pharmacy Orientation",
      "Information Technology",
      "Human Rights & Fighting Corruption",
      "English Language",
      "Pharmacognosy I",
      "Cell Biology"
    ];

    // Default load
    window.onload = function() {
      openSection('records');
    };

    // Logout
    function logout() {
      auth.signOut().then(() => alert("You have been logged out!"));
    }

    // Open Section
    function openSection(type) {
      document.getElementById("subjects-section").style.display = "block";
      document.getElementById("content-section").style.display = "none";
      const grid = document.getElementById("subjects-grid");
      grid.innerHTML = "";
      document.getElementById("section-title").textContent = type.toUpperCase();

      subjects.forEach(subject => {
        const card = document.createElement("div");
        card.className = "card";
        card.textContent = subject;
        card.onclick = () => openContent(subject, type);
        grid.appendChild(card);
      });
    }

    // Open Content
    function openContent(subject, type) {
      document.getElementById("subjects-section").style.display = "none";
      document.getElementById("content-section").style.display = "block";
      document.getElementById("content-title").textContent = subject + " - " + type.toUpperCase();

      const body = document.getElementById("content-body");
      body.innerHTML = "<p>Loading...</p>";

      db.collection(type)
        .where("subject", "==", subject)
        .get()
        .then(snapshot => {
          if (snapshot.empty) {
            body.innerHTML = "<p>No files available.</p>";
          } else {
            body.innerHTML = "";
            snapshot.forEach(doc => {
              const data = doc.data();
              const a = document.createElement("a");
              a.href = data.url; // ✅ تم التعديل من link إلى url
              a.target = "_blank";
              a.className = "pdf-link";
              a.textContent = data.name || "Open File";
              body.appendChild(a);
            });
          }
        })
        .catch(err => {
          body.innerHTML = "<p>Error loading files: " + err.message + "</p>";
        });
    }

    // Back Button
    function goBack() {
      document.getElementById("content-section").style.display = "none";
      document.getElementById("subjects-section").style.display = "block";
    }
  </script>
</body>
</html>
